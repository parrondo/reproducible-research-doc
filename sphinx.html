
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Sphinx-generated Github Page &#8212; reproducible-research-doc  documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Git and GitHub" href="git.html" />
    <link rel="prev" title="Reproducible Research Doc" href="index.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>reproducible-research-doc  documentation</span></a></h1>
        <h2 class="heading"><span>Sphinx-generated Github Page</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Reproducible Research Doc</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="git.html">Git and GitHub</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="sphinx-generated-github-page">
<h1>Sphinx-generated Github Page<a class="headerlink" href="#sphinx-generated-github-page" title="Permalink to this headline">¶</a></h1>
<p>This is a simple tutorial of creating Github page with sphinx supporting both <em>reStructuredText</em> and <em>MarkDown</em> markup language. See <a class="reference external" href="http://www.sphinx-doc.org">Sphinx Official Website</a> for more detail about Sphinx</p>
<div class="section" id="environment-setup">
<h2>Environment Setup<a class="headerlink" href="#environment-setup" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Sphinx is a python based tool, all relevant installation will go through <code class="code docutils literal notranslate"><span class="pre">pip</span></code>. In general, we need to:</dt>
<dd><ul class="first last simple">
<li>install sphinx core</li>
<li>install sphinx theme (for not sphinx builtin themes, example used here is Flask-Sphinx-Themes, change it as you want)</li>
<li>install a <em>MarkDown</em> parser</li>
</ul>
</dd>
</dl>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install <span class="nv">sphinx</span><span class="o">==</span><span class="m">1</span>.5.6
$ pip install Flask-Sphinx-Themes <span class="o">(</span>*optional, <span class="k">for</span> not sphinx <span class="nb">builtin</span> themes, is only an example!*<span class="o">)</span>
$ pip install recommonmark
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Flask-Sphinx-Themes is only an example to ilustrate not sphinx builtin themes, change it as you want.</p>
<p class="last">since <code class="code docutils literal notranslate"><span class="pre">recommonmark</span></code> MarkDown parser has a poor support with sphinx 1.6+. Use sphinx 1.5+ before <code class="code docutils literal notranslate"><span class="pre">recommonmark</span></code> support sphinx 1.6+</p>
</div>
<p>A recommended way to install these packages is putting them into an <code class="code docutils literal notranslate"><span class="pre">environment.yml</span></code> file under project root directory. See <a class="reference external" href="https://conda.io/docs/user-guide/tasks/manage-environments.html">Creating an environment from an environment.yml file</a></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>name: sphinx
dependencies:
  - <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.5   <span class="c1"># or 2.7</span>
  - pip:
    - <span class="nv">sphinx</span><span class="o">==</span><span class="m">1</span>.5.6
    - Flask-Sphinx-Themes *<span class="o">(</span>optional, is only an example!<span class="o">)</span>*
    - recommonmark
</pre></div>
</div>
<p>and execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ conda env create --file environment.yml
$ <span class="nb">source</span> activate sphinx
</pre></div>
</div>
</div>
<div class="section" id="sphinx-configuration">
<h2>Sphinx Configuration<a class="headerlink" href="#sphinx-configuration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="initial-sphinx-set-up">
<h3>Initial Sphinx Set up<a class="headerlink" href="#initial-sphinx-set-up" title="Permalink to this headline">¶</a></h3>
<p>for initial set up of sphinx folders, execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>sphinx<span class="o">)</span>$ sphinx-quickstart
</pre></div>
</div>
<p>this command will guide you initial set up of sphinx document source folder. Most of options can be left default, except a <em>GithubPage</em> option should be set to True.</p>
</div>
<div class="section" id="add-some-folder-to-gitignore">
<span id="gitignore"></span><h3>Add some folder to gitignore<a class="headerlink" href="#add-some-folder-to-gitignore" title="Permalink to this headline">¶</a></h3>
<p>After finishing setup, some build folders should be ignored during git commit. By default, these folders are</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># sphinx document build folders</span>
path_to_sphinx_root/_build/
path_to_sphinx_root/_static/
path_to_sphinx_root/_templates/
</pre></div>
</div>
<p>After finishing initial setup, open and modify <code class="code docutils literal notranslate"><span class="pre">conf.py</span></code>.</p>
</div>
<div class="section" id="add-not-sphinx-builtin-themes-if-necessary">
<h3>Add not sphinx builtin themes if necessary<a class="headerlink" href="#add-not-sphinx-builtin-themes-if-necessary" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>for example, import Flask sphinx theme library</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">Flask</span><span class="o">-</span><span class="n">Sphinx</span><span class="o">-</span><span class="n">Themes</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>set sphinx theme to Flask</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">html_theme</span> <span class="o">=</span> <span class="s2">&quot;Flask-Sphinx-Themes&quot;</span>
<span class="n">html_theme_path</span> <span class="o">=</span> <span class="p">[</span><span class="n">Flask</span><span class="o">-</span><span class="n">Sphinx</span><span class="o">-</span><span class="n">Themes</span><span class="o">.</span><span class="n">get_html_theme_path</span><span class="p">()]</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>set sphinx theme option</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">html_theme_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;github_ribbon_color&#39;</span><span class="p">:</span> <span class="n">darkblue_121621</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>for more Flask Sphinx theme settings, see <a class="reference external" href="https://github.com/rtfd/Flask-Sphinx-Themes">Sphinx Flask github repo</a></p>
</div>
<div class="section" id="add-sphinx-markdown-support">
<h3>Add Sphinx MarkDown Support<a class="headerlink" href="#add-sphinx-markdown-support" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>import markdown parser library</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">recommonmark.parser</span> <span class="kn">import</span> <span class="n">CommonMarkParser</span>
<span class="kn">from</span> <span class="nn">recommonmark.transform</span> <span class="kn">import</span> <span class="n">AutoStructify</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Change <code class="code docutils literal notranslate"><span class="pre">source_suffix</span></code> to following to make parser recognize markdown files</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source_suffix</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.rst&#39;</span><span class="p">,</span> <span class="s1">&#39;.md&#39;</span><span class="p">]</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>add following configuration to make use of markdown parser</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source_parsers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;.md&#39;</span><span class="p">:</span> <span class="n">CommonMarkParser</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">app</span><span class="p">):</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;recommonmark_config&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;enable_eval_rst&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="p">},</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_transform</span><span class="p">(</span><span class="n">AutoStructify</span><span class="p">)</span>
</pre></div>
</div>
<p>if you want to modify setup of recommonmark markdown parser, refer to <a class="reference external" href="https://recommonmark.readthedocs.io/en/latest/">Recommonmark Documentation</a></p>
</div>
<div class="section" id="index-rst-setup">
<h3>Index.rst setup<a class="headerlink" href="#index-rst-setup" title="Permalink to this headline">¶</a></h3>
<p>Although <code class="code docutils literal notranslate"><span class="pre">recommonmark</span></code> support sphinx markdown parsing, it still lack of some functionality. One of them is <code class="code docutils literal notranslate"><span class="pre">toctree</span></code> which allow you to see documentation structure on the left-hand side of webpage. To enable <code class="code docutils literal notranslate"><span class="pre">toctree</span></code>, we need to write index file in <code class="code docutils literal notranslate"><span class="pre">rst</span></code> format. The <code class="code docutils literal notranslate"><span class="pre">index.rst</span></code> will contain only documentation title (automatically generated during initial setup) and files need to contain in the <code class="code docutils literal notranslate"><span class="pre">toctree</span></code> sections. a sample format is as below</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span><span class="p">..</span> <span class="ow">toctree</span><span class="p">::</span>
   <span class="nc">:glob:</span>
   <span class="nc">:caption:</span> <span class="nf">section title</span>

   docs_folder_name/*
   doc_file_name1.md
   doc_file_name2.rst
</pre></div>
</div>
<p>As code sample above, document files can be found with regular expression pattern matching. This is accomplished by <code class="code docutils literal notranslate"><span class="pre">:glob:</span></code> attribute. It avoids adding document file name to index every time a new file is created, but files that failed in pattern matching still need to be added manually. For more information of how to write <code class="code docutils literal notranslate"><span class="pre">toctree</span></code>, see <a class="reference external" href="http://www.sphinx-doc.org/en/stable/markup/toctree.html">Sphinx TOC tree Docs</a></p>
</div>
</div>
<div class="section" id="write-documentation">
<h2>Write Documentation<a class="headerlink" href="#write-documentation" title="Permalink to this headline">¶</a></h2>
<p>Make your text as literal and specific as possible. Put yourself in the place of the person who is using your project
and looking for instructions on performing a task. Don’t make them guess, but spell
out every step in order, and tell exactly what buttons to click or what form
fields to fill out. Give complete information; for example, when using a
time variable be sure to say if it is in seconds, miliseconds or some other unit value.</p>
<p>Generally, writing <code class="code docutils literal notranslate"><span class="pre">rst</span></code> format documents is recommended for sphinx. If you want still using <strong>markdown</strong>. Following some rules to make sphinx parser generate <code class="code docutils literal notranslate"><span class="pre">toctree</span></code> correctly.</p>
<p>Use Apendix templates to write your text.</p>
</div>
<div class="section" id="locally-view-documentation">
<h2>Locally View Documentation<a class="headerlink" href="#locally-view-documentation" title="Permalink to this headline">¶</a></h2>
<p>Before pushing your documents to repository, viewing them locally to make sure it displays as expected and check no any typo. To do so, simply execute following command in sphinx root directory where Makefile file lives (not project root directory)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ make html
</pre></div>
</div>
<p>if you didn’t change settings during initial setup, a folder named <code class="code docutils literal notranslate"><span class="pre">_build</span></code> will show up, inside this folder, there is a <code class="code docutils literal notranslate"><span class="pre">html</span></code> folder. Open <code class="code docutils literal notranslate"><span class="pre">index.html</span></code> and you should be able to view documentation webpage locally.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When you modify some files and rebuild documentation page, but didn’t see any changes, clean temperary build files by running</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>$ make clean
</pre></div>
</div>
</div>
</div>
<div class="section" id="deploy-to-github-page">
<h2>Deploy to Github Page<a class="headerlink" href="#deploy-to-github-page" title="Permalink to this headline">¶</a></h2>
<p>Since obtaining Sphinx Documentation requires a build step, there are several ways to deploy built sphinx page to Github page. The msimplest is to use <a class="reference external" href="https://github.com/parrondo/git-simple">git-simple</a> . Another one is built locally yourself and push. An finally, other is using some automatic built services (like Travis-CI) which will automatically build and deploy for you.</p>
<div class="section" id="first-option-deploy-by-git-simple">
<h3>First option: Deploy by git-simple<a class="headerlink" href="#first-option-deploy-by-git-simple" title="Permalink to this headline">¶</a></h3>
<p>You can deploy easily your gh-pages docs using gpublish command from <a class="reference external" href="https://github.com/parrondo/git-simple">git-simple</a>
You only need to install git-simple shell scripts (very easy and clean)</p>
</div>
<div class="section" id="second-option-locally-built-and-deploy-by-push">
<h3>Second option: Locally built and deploy by push<a class="headerlink" href="#second-option-locally-built-and-deploy-by-push" title="Permalink to this headline">¶</a></h3>
<p>Deploy by github push needs 6 steps:</p>
<ol class="arabic simple">
<li>create a <code class="code docutils literal notranslate"><span class="pre">source</span></code> directory inside docs folder of repo root directory and move everything in sphinx root to new folder</li>
<li>allow git to track sphinx temp file by removing these lines shown <a class="reference internal" href="#gitignore">gitignore</a> section</li>
<li>Change Sphinx build path to parent directory of sphinx root directory by changing two lines in <code class="code docutils literal notranslate"><span class="pre">Makefile</span></code> and <code class="code docutils literal notranslate"><span class="pre">make.bat</span></code>:</li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># in Makefile</span>
<span class="nv">BUILDDIR</span><span class="o">=</span>_build        -&gt;       <span class="nv">BUILDDIR</span><span class="o">=</span>..
<span class="c1"># in make.bat</span>
<span class="nb">set</span> <span class="nv">BUILDDIR</span><span class="o">=</span>_build    -&gt;       <span class="nb">set</span> <span class="nv">BUILDDIR</span><span class="o">=</span>..
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>execute following command to move files to docs folder in <em>root docs directory</em></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mv html/* ./
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>if this command reports error, there are several possibilities:</p>
<ol class="last arabic simple">
<li>didn’t build document with <code class="code docutils literal notranslate"><span class="pre">make</span> <span class="pre">html</span></code></li>
<li>execute in wrong directory.</li>
<li>may need to clean the <em>root docs directory</em>, only leave <em>source</em> folder there and <em>html</em> folder there</li>
</ol>
</div>
<ol class="arabic simple" start="5">
<li>commit every change in docs folder and push it to github</li>
<li>(only needs to be done once) change github repo github page settings, make source to be <em>master branch /docs folder</em></li>
</ol>
</div>
<div class="section" id="third-option-deploy-with-travis-ci">
<h3>Third option: Deploy with Travis-CI<a class="headerlink" href="#third-option-deploy-with-travis-ci" title="Permalink to this headline">¶</a></h3>
<p>Deploy with Travis-CI basically needs 4 steps:</p>
<ol class="arabic simple">
<li>modify <code class="code docutils literal notranslate"><span class="pre">.travis.yml</span></code> configuration by adding the following (only works in python environment). For more information about travis github page deployment, see <a class="reference external" href="https://docs.travis-ci.com/user/deployment/pages/">Travis Configuration</a></li>
</ol>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>install:            <span class="c1"># Install requirement as &quot;Environment Setup Section&quot;</span>
- pip install -r sphinx_root/requirements.txt
script:             <span class="c1"># build sphinx document</span>
- <span class="nb">cd</span> sphinx_root/
- make html
- <span class="nb">cd</span> -
deploy              <span class="c1"># deploy to github page</span>
- provider: pages
  skip_cleanup: <span class="nb">true</span>
  local_dir: sphinx_root/_build/html
  github_token: <span class="nv">$GITHUB_TOKEN</span> <span class="c1"># Set in travis-ci.org dashboard</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Obtain Github personal token.
This Token can be anyone who has access right to Repository. To obtain this token, Go to personal Github settings, At very end of left column, click <em>personal access tokens</em> and create a new one. With regards to Scope option during token creation, only <code class="code docutils literal notranslate"><span class="pre">public_repo</span></code> should be selected for safety.  Put this token in Travis-CI environment variable settings with name corresponding to travis script</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Whoever use their own <em>personal access token</em>, every auto deployment commit will be treated as their commit. For a team, it’s recommended to use tokens from organization</p>
</div>
<ol class="arabic simple" start="3">
<li>Change repository settings
repository manager should change github page source to branch <code class="code docutils literal notranslate"><span class="pre">gh-pages</span></code> branch. This branch will be created during auto deployment by default.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="code docutils literal notranslate"><span class="pre">gh-pages</span></code> branch can’t be a protected branch, otherwise, Travis-CI won’t be able to push to repository.</p>
</div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="index.html">Reproducible Research Doc</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="git.html">Git and GitHub</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Parrondo.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>